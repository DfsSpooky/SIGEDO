{% error_forzado %}
{% load i18n unfold_tags %}

<header class="sticky top-0 z-20 w-full bg-white shadow dark:bg-gray-800">
    <div class="flex h-16 items-center justify-between p-4">
        <div class="flex items-center">
            {% include "unfold/helpers/button.html" with type="button" icon="menu" class="mr-2" extra_attributes="x-on:click=\"sidebarOpen = !sidebarOpen\"" only %}
            <div class="hidden lg:block">
                {% include "unfold/helpers/logo.html" %}
            </div>
        </div>

        <div class="flex items-center gap-x-4">
            {% if "unfold.contrib.search"|is_installed %}
                {% include "unfold/contrib/search.html" %}
            {% endif %}

            <!-- NEW: NOTIFICATION BELL -->
            <div x-data="{ open: false }" class="relative">
                <button @click="open = !open" class="relative text-gray-600 dark:text-gray-300 focus:outline-none">
                    <span class="material-symbols-outlined">notifications</span>
                    {% if unread_notifications_count > 0 %}
                    <span id="notification-badge" class="absolute -top-2 -right-2 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs font-bold text-white">
                        {{ unread_notifications_count }}
                    </span>
                    {% endif %}
                </button>

                <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-2 w-80 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 dark:bg-gray-700" style="display: none;">
                    <div class="p-4 border-b dark:border-gray-600">
                        <h4 class="text-md font-medium text-gray-900 dark:text-white">Notificaciones</h4>
                    </div>

                    <div id="notification-list" class="divide-y divide-gray-100 dark:divide-gray-600 max-h-96 overflow-y-auto">
                        {% for notification in recent_notifications %}
                        <a href="{{ notification.url }}" data-notification-id="{{ notification.id }}" class="block p-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <p class="font-medium text-gray-800 dark:text-gray-200">{{ notification.mensaje }}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ notification.fecha_creacion|timesince }} ago</p>
                        </a>
                        {% empty %}
                        <p class="p-4 text-sm text-gray-500 dark:text-gray-400">No tienes notificaciones nuevas.</p>
                        {% endfor %}
                    </div>

                    <div class="border-t border-gray-100 dark:border-gray-600">
                        <a href="{% url 'admin:core_notificacion_changelist' %}" class="block p-3 text-center text-sm font-medium text-blue-600 hover:bg-gray-50 dark:text-blue-400 dark:hover:bg-gray-600">
                            Ver todas las notificaciones
                        </a>
                    </div>
                </div>
            </div>
            <!-- END: NOTIFICATION BELL -->

            {% if "unfold.contrib.user_links"|is_installed %}
                {% include "unfold/contrib/user_links.html" %}
            {% endif %}
        </div>
    </div>
</header>
