{% load static %}
<div class="space-y-8">

    <!-- KPI Cards - Updated to use direct context variables -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="card bg-white shadow-lg border-l-4 border-blue-500">
            <div class="card-body p-5">
                <p class="text-sm font-medium text-gray-500">Docentes Activos</p>
                <p class="text-3xl font-extrabold">{{ docentes_activos }}</p>
            </div>
        </div>
        <div class="card bg-white shadow-lg border-l-4 border-yellow-500">
            <div class="card-body p-5">
                <p class="text-sm font-medium text-gray-500">Justificaciones Pendientes</p>
                <p class="text-3xl font-extrabold">{{ justificaciones_pendientes }}</p>
            </div>
        </div>
        <div class="card bg-white shadow-lg border-l-4 border-red-500">
            <div class="card-body p-5">
                <p class="text-sm font-medium text-gray-500">Documentos Pendientes</p>
                <p class="text-3xl font-extrabold">{{ documentos_pendientes }}</p>
            </div>
        </div>
        <div class="card bg-white shadow-lg border-l-4 border-purple-500">
            <div class="card-body p-5">
                <p class="text-sm font-medium text-gray-500">Reservas Pendientes</p>
                <p class="text-3xl font-extrabold">{{ reservas_pendientes }}</p>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
        <div class="lg:col-span-3 card bg-white shadow-lg p-6">
            <h2 class="text-lg font-semibold mb-4">Asistencia de la Última Semana</h2>
            <canvas id="asistenciaSemanalChart"></canvas>
        </div>
        <div class="lg:col-span-2 card bg-white shadow-lg p-6">
            <h2 class="text-lg font-semibold mb-4">Estado General de Documentos</h2>
            <canvas id="documentosStatusChart"></canvas>
        </div>
    </div>

    <!-- NEW: Unified Inbox -->
    <div class="card bg-white shadow-lg">
        <div class="card-body p-6">
            <h2 class="text-xl font-semibold mb-4">Bandeja de Entrada</h2>
            <div class="space-y-4">
                {% for item in inbox_items %}
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50">
                    <span class="material-symbols-outlined text-gray-600 mr-4">{{ item.icon }}</span>
                    <div class="flex-grow">
                        <p class="font-medium">{{ item.tipo }}</p>
                        <p class="text-sm text-gray-700">{{ item.texto }}</p>
                        <p class="text-xs text-gray-500">{{ item.fecha|date:"d M, Y P" }}</p>
                    </div>
                    <a href="{{ item.url }}" class="ml-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm font-semibold">
                        Revisar
                    </a>
                </div>
                {% empty %}
                <div class="text-center py-10">
                    <span class="material-symbols-outlined text-6xl text-green-500">task_alt</span>
                    <p class="mt-4 text-lg font-semibold text-gray-700">¡Todo al día!</p>
                    <p class="text-gray-500">No hay tareas pendientes en tu bandeja de entrada.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Note: The original template used `module.children.0.charts_data...`
    // This might need adjustment if the data source has changed. For now, assuming it still works.
    // If charts are broken, this is the place to fix it.
    try {
        const asistenciaData = {{ module.children.0.charts_data.asistencia_semanal_json|safe }};
        const documentosData = {{ module.children.0.charts_data.documentos_status_json|safe }};

        if (asistenciaData && documentosData) {
            new Chart(document.getElementById('asistenciaSemanalChart'), {
                type: 'bar',
                data: {
                    labels: asistenciaData.labels,
                    datasets: [{ label: 'Presentes', data: asistenciaData.presentes, backgroundColor: 'rgba(54, 162, 235, 0.6)' }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });

            new Chart(document.getElementById('documentosStatusChart'), {
                type: 'doughnut',
                data: {
                    labels: documentosData.labels,
                    datasets: [{ data: documentosData.data, backgroundColor: ['#4ade80', '#facc15', '#f87171', '#60a5fa'] }]
                },
                options: { responsive: true }
            });
        }
    } catch (e) {
        console.error("Error al renderizar los gráficos del dashboard:", e);
        // Optionally hide the chart containers if data is unavailable
        document.getElementById('asistenciaSemanalChart').parentElement.style.display = 'none';
        document.getElementById('documentosStatusChart').parentElement.style.display = 'none';
    }
});
</script>
